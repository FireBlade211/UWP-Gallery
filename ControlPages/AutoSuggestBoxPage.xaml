<Page
    x:Class="UWPGallery.ControlPages.AutoSuggestBoxPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:UWPGallery.ControlPages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    xmlns:controls="using:UWPGallery.Controls"
    xmlns:datamodel="using:UWPGallery.DataModel">

    <StackPanel Spacing="12">
        <controls:GallerySample HeaderTitle="Basic AutoSuggestBox">
            <AutoSuggestBox TextChanged="AutoSuggestBox_TextChanged"
                SuggestionChosen="AutoSuggestBox_SuggestionChosen"
                Width="300" PlaceholderText="Search cats" HorizontalAlignment="Left"/>

            <controls:GallerySample.XamlSource>
                <x:String xml:space="preserve">
&lt;AutoSuggestBox TextChanged="AutoSuggestBox_TextChanged"
    SuggestionChosen="AutoSuggestBox_SuggestionChosen"
    Width="300" PlaceholderText="Search cats"/&gt;
                </x:String>
            </controls:GallerySample.XamlSource>

            <controls:GallerySample.CSharpSource>
                <x:String xml:space="preserve">
private List&lt;string&gt; Cats = new List&lt;string&gt;()
{
    "Abyssinian",
    "Aegean",
    "American Bobtail",
    "American Curl",
    "American Ringtail",
    "American Shorthair",
    "American Wirehair",
    "Aphrodite Giant",
    "Arabian Mau",
    "Asian cat",
    "Asian Semi-longhair",
    "Australian Mist",
    ...
};
                    
private void AutoSuggestBox_TextChanged(AutoSuggestBox sender, AutoSuggestBoxTextChangedEventArgs args)
{
    // Since selecting an item will also change the text,
    // only listen to changes caused by user entering text.
    if (args.Reason == AutoSuggestionBoxTextChangeReason.UserInput)
    {
        var suitableItems = new List&lt;string&gt;();
        var splitText = sender.Text.ToLower().Split(' ');
        foreach (var cat in Cats)
        {
            var found = splitText.All((key) =>
            {
                return cat.ToLower().Contains(key);
            });
            if (found)
            {
                suitableItems.Add(cat);
            }
        }
        if (suitableItems.Count == 0)
        {
            suitableItems.Add("No results found");
        }
        sender.ItemsSource = suitableItems;
    }
}

private void AutoSuggestBox_SuggestionChosen(AutoSuggestBox sender, AutoSuggestBoxSuggestionChosenEventArgs args)
{
    var f = new Flyout();
    f.Content = new TextBlock
    {
        Style = (Style)Application.Current.Resources["BaseTextBlockStyle"],
        Text = "You chose: " + args.SelectedItem.ToString()
    };

    f.ShowAt(sender);
}
                </x:String>
            </controls:GallerySample.CSharpSource>
        </controls:GallerySample>

        <controls:GallerySample HeaderTitle="A Search-style AutoSuggestBox">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <AutoSuggestBox
                    x:Name="Control2"
                    Width="300"
                    HorizontalAlignment="Left"
                    PlaceholderText="Type a control name"
                    QueryIcon="Find"
                    QuerySubmitted="Control2_QuerySubmitted"
                    SuggestionChosen="Control2_SuggestionChosen"
                    TextChanged="Control2_TextChanged" />
                <RelativePanel
                    x:Name="ControlDetails"
                    Grid.Row="1"
                    Margin="0,8,0,0"
                    HorizontalAlignment="Left"
                    Visibility="Collapsed">
                    <FontIcon x:Name="ControlImage" FontSize="48" FontFamily="{StaticResource SymbolThemeFontFamily}" />
                    <TextBlock
                        x:Name="ControlTitle"
                        Margin="8,0,0,0"
                        RelativePanel.RightOf="ControlImage"
                        Style="{StaticResource BaseTextBlockStyle}" />
                    <TextBlock
                        x:Name="ControlSubtitle"
                        Margin="8,0,0,0"
                        RelativePanel.AlignLeftWith="ControlTitle"
                        RelativePanel.Below="ControlTitle"
                        TextWrapping="WrapWholeWords" />
                </RelativePanel>
            </Grid>

            <controls:GallerySample.XamlSource>
                <x:String xml:space="preserve">
&lt;AutoSuggestBox PlaceholderText="Type a control name"
    TextChanged="AutoSuggestBox_TextChanged"
    QueryIcon="Find"
    QuerySubmitted="AutoSuggestBox_QuerySubmitted"
    SuggestionChosen="AutoSuggestBox_SuggestionChosen"/&gt;
                </x:String>
            </controls:GallerySample.XamlSource>
        </controls:GallerySample>

        <controls:GallerySample HeaderTitle="An AutoSuggestBox with a custom item template">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <AutoSuggestBox
                    x:Name="Control3"
                    Width="300"
                    HorizontalAlignment="Left"
                    PlaceholderText="Type a control name"
                    QueryIcon="Find"
                    QuerySubmitted="Control2_QuerySubmitted"
                    SuggestionChosen="Control2_SuggestionChosen"
                    TextChanged="Control2_TextChanged">
                    <AutoSuggestBox.ItemTemplate>
                        <DataTemplate x:DataType="datamodel:ControlInfoDataItem">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="{x:Bind IconGlyph}" FontSize="16"/>
                                <TextBlock TextTrimming="CharacterEllipsis" Text="{x:Bind Title}" ToolTipService.ToolTip="{x:Bind Subtitle}"
                                       AutomationProperties.FullDescription="{x:Bind Description}"/>
                            </StackPanel>
                        </DataTemplate>
                    </AutoSuggestBox.ItemTemplate>
                    
                </AutoSuggestBox>
                <RelativePanel
                    x:Name="ControlDetails2"
                    Grid.Row="1"
                    Margin="0,8,0,0"
                    HorizontalAlignment="Left"
                    Visibility="Collapsed">
                    <FontIcon x:Name="ControlImage2" FontSize="48" FontFamily="{StaticResource SymbolThemeFontFamily}" />
                    <TextBlock
                        x:Name="ControlTitle2"
                        Margin="8,0,0,0"
                        RelativePanel.RightOf="ControlImage2"
                        Style="{StaticResource BaseTextBlockStyle}" />
                    <TextBlock
                        x:Name="ControlSubtitle2"
                        Margin="8,0,0,0"
                        RelativePanel.AlignLeftWith="ControlTitle2"
                        RelativePanel.Below="ControlTitle2"
                        TextWrapping="WrapWholeWords" />
                </RelativePanel>
            </Grid>

            <controls:GallerySample.XamlSource>
                <x:String xml:space="preserve">
&lt;AutoSuggestBox PlaceholderText="Type a control name"
    TextChanged="AutoSuggestBox_TextChanged"
    QueryIcon="Find"
    QuerySubmitted="AutoSuggestBox_QuerySubmitted"
    SuggestionChosen="AutoSuggestBox_SuggestionChosen"&gt;
                    
        &lt;AutoSuggestBox.ItemTemplate&gt;
            &lt;DataTemplate x:DataType="datamodel:ControlInfoDataItem"&gt;
                &lt;StackPanel Orientation="Horizontal" Spacing="12"&gt;
                    &lt;FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="{x:Bind IconGlyph}" FontSize="16"/&gt;
                    &lt;TextBlock TextTrimming="CharacterEllipsis" Text="{x:Bind Title}" ToolTipService.ToolTip="{x:Bind Subtitle}"
                            AutomationProperties.FullDescription="{x:Bind Description}"/&gt;
                &lt;/StackPanel&gt;
            &lt;/DataTemplate&gt;
        &lt;/AutoSuggestBox.ItemTemplate&gt;
                    
&lt;/AutoSuggestBox&gt;  
                </x:String>
            </controls:GallerySample.XamlSource>
        </controls:GallerySample>

        <controls:GallerySample HeaderTitle="AutoSuggestBox embedded in NavigationView" MinHeight="500">
            <controls:GallerySample.Sample>
                <Grid RowSpacing="6">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock TextWrapping="WrapWholeWords">NavigationView allows you to embed an AutoSuggestBox within it to act as a search box. For more info, see <Hyperlink NavigateUri="uwp-gallery:///page/navview#navigationview-search-box">NavigationView</Hyperlink>.</TextBlock>

                    <NavigationView Grid.Row="1" x:Name="NavViewSearchBoxSample" Loaded="NavViewSearchBoxSample_Loaded"
                                    SelectionChanged="NavViewSearchBoxSample_SelectionChanged">
                        <NavigationView.AutoSuggestBox>
                            <AutoSuggestBox
                                x:Name="SearchBox"
                                MinWidth="200"
                                VerticalAlignment="Center"
                                PlaceholderText="Search..."
                                QueryIcon="Find"
                                TextChanged="SearchBox_TextChanged"
                                QuerySubmitted="SearchBox_QuerySubmitted"/>
                        </NavigationView.AutoSuggestBox>

                        <NavigationView.MenuItems>
                            <NavigationViewItem Content="People" Icon="OtherUser" Tag="1"/>
                            <NavigationViewItem Content="Globe" Icon="Globe" Tag="2"/>
                            <NavigationViewItem Content="Messages" Icon="Message" Tag="3"/>
                            <NavigationViewItem Content="Mail" Icon="Mail" Tag="4"/>
                            <NavigationViewItem Content="Phone" Icon="Phone" Tag="5"/>
                        </NavigationView.MenuItems>

                        <Frame x:Name="NavViewSearchBoxSampleFrame"/>
                    </NavigationView>
                </Grid>
            </controls:GallerySample.Sample>

            <controls:GallerySample.XamlSource>
                <x:String xml:space="preserve">
&lt;Grid RowSpacing="6"&gt;
    &lt;Grid.RowDefinitions&gt;
        &lt;RowDefinition Height="Auto"/&gt;
        &lt;RowDefinition Height="*"/&gt;
    &lt;/Grid.RowDefinitions&gt;

    &lt;TextBlock TextWrapping="WrapWholeWords"&gt;NavigationView allows you to embed an AutoSuggestBox within it to act as a search box. For more info, see &lt;Hyperlink NavigateUri="uwp-gallery:///page/navview#navigationview-search-box"&gt;NavigationView&lt;/Hyperlink&gt;.&lt;/TextBlock&gt;

    &lt;NavigationView Grid.Row="1" x:Name="NavViewSearchBoxSample" Loaded="NavViewSearchBoxSample_Loaded"
                    SelectionChanged="NavViewSearchBoxSample_SelectionChanged"&gt;
        &lt;NavigationView.AutoSuggestBox&gt;
            &lt;AutoSuggestBox
                x:Name="SearchBox"
                MinWidth="200"
                VerticalAlignment="Center"
                PlaceholderText="Search..."
                QueryIcon="Find"
                TextChanged="SearchBox_TextChanged"
                QuerySubmitted="SearchBox_QuerySubmitted"/&gt;
        &lt;/NavigationView.AutoSuggestBox&gt;

        &lt;NavigationView.MenuItems&gt;
            &lt;NavigationViewItem Content="People" Icon="OtherUser" Tag="1"/&gt;
            &lt;NavigationViewItem Content="Globe" Icon="Globe" Tag="2"/&gt;
            &lt;NavigationViewItem Content="Messages" Icon="Message" Tag="3"/&gt;
            &lt;NavigationViewItem Content="Mail" Icon="Mail" Tag="4"/&gt;
            &lt;NavigationViewItem Content="Phone" Icon="Phone" Tag="5"/&gt;
        &lt;/NavigationView.MenuItems&gt;

        &lt;Frame x:Name="NavViewSearchBoxSampleFrame"/&gt;
    &lt;/NavigationView&gt;
&lt;/Grid&gt;
                </x:String>
            </controls:GallerySample.XamlSource>

            <controls:GallerySample.CSharpSource>
                <x:String xml:space="preserve">
private void NavViewSearchBoxSample_Loaded(object sender, RoutedEventArgs e)
{
    var items = NavViewSearchBoxSample.MenuItems.Select(string (object navItem) =>
    {
        if (navItem is NavigationViewItem item)
        {
            return item.Content.ToString() ?? string.Empty;
        }

        return string.Empty;
    }).ToList();

    items.Add("Settings");

    SearchBox.ItemsSource = items;
}

private void NavViewSearchBoxSample_SelectionChanged(NavigationView sender, NavigationViewSelectionChangedEventArgs args)
{
    if (args.IsSettingsSelected)
        NavViewSearchBoxSampleFrame.Navigate(typeof(SampleSettingsPage), null, args.RecommendedNavigationTransitionInfo);
    else
    {
        if (NavViewSearchBoxSample.SelectedItem is NavigationViewItem item)
        {
            if (item.Tag is string s)
            {
                Type? pageType = Type.GetType("UWPGallery.SamplePages.SamplePage" + s);

                if (pageType != null)
                {
                    NavViewSearchBoxSampleFrame.Navigate(pageType, null, args.RecommendedNavigationTransitionInfo);
                }
            }
        }
    }
}

private void SearchBox_TextChanged(AutoSuggestBox sender, AutoSuggestBoxTextChangedEventArgs args)
{
    var querySplit = SearchBox.Text.ToLower().Split(" ");

    var items = NavViewSearchBoxSample.MenuItems.Select(string (object navItem) =>
    {
        if (navItem is NavigationViewItem item)
        {
            return item.Content.ToString() ?? string.Empty;
        }

        return string.Empty;
    }).ToList();

    items.Add("Settings");

    SearchBox.ItemsSource = items.Where(x =>
    {
        // Idea: check for every word entered (separated by space) if it is in the name,
        // e.g. for query "split button" the only result should "SplitButton" since its the only query to contain "split" and "button"
        // If any of the sub tokens is not in the string, we ignore the item. So the search gets more precise with more words
        bool flag = true;
        foreach (string queryToken in querySplit)
        {
            // Check if token is in name
            if (!x.Contains(queryToken, StringComparison.OrdinalIgnoreCase))
            {
                // The title doesn't contain one of the tokens so we discard this item!
                flag = false;
            }
        }
        return flag;
    }).ToList();
}

private void SearchBox_QuerySubmitted(AutoSuggestBox sender, AutoSuggestBoxQuerySubmittedEventArgs args)
{
    if (args.ChosenSuggestion is string s)
    {
        if (s.Equals("Settings", StringComparison.Ordinal))
        {
            NavViewSearchBoxSample.SelectedItem = NavViewSearchBoxSample.SettingsItem;
        }
        else
        {
            foreach (var item in NavViewSearchBoxSample.MenuItems)
            {
                if (item is NavigationViewItem navItem)
                {
                    if (navItem.Content is string ss)
                    {
                        if (s.Equals(ss, StringComparison.Ordinal))
                        {
                            NavViewSearchBoxSample.SelectedItem = navItem;
                            break;
                        }
                    }
                }
            }
        }
    }
}
                </x:String>
            </controls:GallerySample.CSharpSource>
        </controls:GallerySample>
    </StackPanel>
</Page>
